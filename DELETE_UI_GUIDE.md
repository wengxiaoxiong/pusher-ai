# 删除工具前端界面指南

## 概述

AiPusher 提供了两种方式来删除 Todos、Milestones 和 Memos：

1. **AI 对话方式** - 通过自然语言让 AI 识别并执行删除
2. **UI 按钮方式** - 通过删除面板中的按钮直接删除（新增）

本指南介绍新增的前端 UI 删除功能。

## 功能组件

### DeleteActions 组件 (`components/delete-actions.tsx`)

这是一个可复用的删除操作组件，提供了以下功能：

**功能特性**：
- ✅ 显示所有可删除的项目（Todos、Milestones、Memos）
- ✅ 可滚动列表（最多显示所有项目）
- ✅ 删除前确认对话框
- ✅ 实时删除状态反馈
- ✅ 无删除项目时的提示

**Props 配置**：
```typescript
interface DeleteActionsProps {
  todos: Todo[]                                              // 待办列表
  milestones: Milestone[]                                   // 里程碑列表
  memos: Memo[]                                             // 备忘录列表
  onDelete?: (type: "todo" | "milestone" | "memo", name: string) => void  // 删除后回调
  disabled?: boolean                                        // 禁用状态
}
```

**组件导入**：
```typescript
import { DeleteActions } from "@/components/delete-actions"
```

## 拉齐页面集成

### 使用方式

在 `/app/align/page.tsx` 中已经集成了删除功能：

#### 1. 打开删除面板
- 点击 Dashboard 右侧的 **"删除"** 按钮
- 删除面板会展开，显示所有可删除的项目

#### 2. 选择要删除的项目
- 每个项目卡片右侧有一个 **🗑️ 按钮**
- 点击删除按钮，打开确认对话框

#### 3. 确认删除
- 对话框显示要删除的项目名称
- 点击 **"删除"** 确认，或点击 **"取消"** 返回

#### 4. 删除完成
- 删除操作通过 AI 工具执行
- 500ms 后自动刷新 Dashboard 数据

### 页面布局

```
┌─────────────────────────────────────────────┐
│  拉齐页面                                   │
├─────────────────────┬───────────────────────┤
│                     │  Dashboard 面板        │
│                     │  ┌─────────────┐      │
│  对话区域           │  │ 刷新 [删除]← │← 新增  │
│                     │  └─────────────┘      │
│                     │  ┌─────────────┐      │
│                     │  │ 统计数据     │      │
│                     │  └─────────────┘      │
│                     │  ┌─────────────┐      │
│                     │  │ 里程碑       │      │
│                     │  └─────────────┘      │
│                     │  ┌─────────────┐      │
│                     │  │ Todos        │      │
│                     │  └─────────────┘      │
│                     │  ┌─────────────┐      │
│                     │  │ 记忆         │      │
│                     │  └─────────────┘      │
│                     │  ┌─────────────┐      │
│                     │  │ 删除面板 (展开时) │
│                     │  │  ✕ 待办1     │      │
│                     │  │  ✕ 待办2     │      │
│                     │  │  ✕ 里程碑1   │      │
│                     │  │  ✕ 备忘1     │      │
│                     │  └─────────────┘      │
└─────────────────────┴───────────────────────┘
```

## 删除面板详细说明

### 删除待办 (Delete Todos)

每个待办项目显示：
- **标题** - Todo 的名称
- **状态** - "已完成" 或 "未完成"
- **阻塞标记** - 如果是阻塞任务会显示 ⚠️
- **删除按钮** - 右侧的 🗑️ 按钮

```
┌─────────────────────────────────────┐
│ 删除待办                            │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 制作视频 | 未完成               🗑️│ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ 代码审核 | 进行中                 🗑️│ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 删除里程碑 (Delete Milestones)

每个里程碑项目显示：
- **标题** - 里程碑的名称
- **进度条** - 当前的完成进度
- **进度百分比** - 数字形式的进度
- **删除按钮** - 右侧的 🗑️ 按钮

```
┌─────────────────────────────────────┐
│ 删除里程碑                          │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ Q4季度目标                        🗑️│
│ │ ████████░░░░░░░░░░░░░░░░░░░░░  │ │
│ │ 50% 完成                         │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ 产品发布                          🗑️│
│ │ ██████████████████░░░░░░░░░░░░  │ │
│ │ 75% 完成                         │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 删除备忘录 (Delete Memos)

每个备忘录项目显示：
- **键名** - 备忘录的唯一标识符
- **内容** - 备忘录的文本内容（最多2行）
- **分类标签** - 备忘录的分类（如：financial、technical 等）
- **删除按钮** - 右侧的 🗑️ 按钮

```
┌─────────────────────────────────────┐
│ 删除备忘录                          │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ financial-threshold               🗑️│
│ │ 财务预警阈值下调到 3 万           │ │
│ │ [financial]                      │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ team-meeting-time                 🗑️│
│ │ 周五例会时间改为下午 2 点         │ │
│ │ [team]                           │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

## 删除确认对话框

点击删除按钮后，会弹出确认对话框：

```
┌──────────────────────────────────────────────┐
│ ⚠️  确认删除                               X │
├──────────────────────────────────────────────┤
│ 这个操作无法撤销，确定要删除吗？             │
│                                             │
│ 待办:                                       │
│ 制作视频                                    │
│                                             │
│                        [取消]  [删除]      │
└──────────────────────────────────────────────┘
```

**确认对话框信息**：
- 标题："确认删除" (红色警告)
- 描述：提醒用户删除无法撤销
- 显示要删除项目的类型和名称
- 两个按钮：取消和删除

## 工作流程

### 完整的删除流程

```
1. 用户在拉齐页面
   ↓
2. 点击 Dashboard 右侧的 "删除" 按钮
   ↓
3. 删除面板展开，显示所有可删除项目
   ↓
4. 点击某项目的 🗑️ 按钮
   ↓
5. 确认对话框弹出
   ↓
6. 用户点击 "删除" 确认
   ↓
7. 删除请求发送到 /api/align (AI 执行)
   ↓
8. 500ms 后自动刷新 Dashboard 数据
   ↓
9. 项目从列表中消失
```

### 状态管理

**删除面板状态**：
```typescript
const [showDeletePanel, setShowDeletePanel] = useState(false)
```

**删除确认对话框状态**：
```typescript
const [deleteConfirm, setDeleteConfirm] = useState<{
  type: "todo" | "milestone" | "memo"
  name: string
} | null>(null)
```

## 技术实现细节

### 删除请求

```typescript
const response = await fetch("/api/align", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    messages: [
      {
        role: "user",
        content: `删除待办"${name}"`,  // 或其他类型
      },
    ],
  }),
})
```

### 删除触发

删除通过发送自然语言消息到 AI 来执行：
- 删除待办：`删除待办"${name}"`
- 删除里程碑：`删除里程碑"${name}"`
- 删除备忘录：`删除备忘录"${name}"`

### 数据刷新

删除后的数据刷新：
```typescript
onDelete={() => {
  // 延迟刷新数据，等待 AI 工具执行完成
  setTimeout(() => loadDashboardData(), 500)
}}
```

## 样式说明

### 颜色方案

**删除面板卡片**：
- 边框色：`border-red-200`
- 背景色：`bg-red-50/50`（半透明红色）
- 标题色：正常文字颜色
- 描述色：`text-xs` 灰色

**删除按钮**：
- 常态：`hover:bg-red-100 hover:text-red-600`
- 按下：红色背景 + 白字
- 禁用：灰化

**删除确认按钮**：
- 背景：`bg-red-600`
- 悬停：`hover:bg-red-700`
- 文字：白色

### 响应式设计

- 删除面板最大高度：`max-h-48`（可滚动）
- 项目卡片：水平平铺，自适应宽度
- 删除按钮：固定右侧，不随内容折叠

## 集成示例

### 在其他页面使用删除组件

```typescript
import { DeleteActions } from "@/components/delete-actions"

export function MyPage() {
  const [todos, setTodos] = useState<Todo[]>([])
  const [milestones, setMilestones] = useState<Milestone[]>([])
  const [memos, setMemos] = useState<Memo[]>([])

  return (
    <DeleteActions
      todos={todos}
      milestones={milestones}
      memos={memos}
      onDelete={(type, name) => {
        console.log(`Deleted ${type}: ${name}`)
        // 刷新数据
      }}
      disabled={isLoading}
    />
  )
}
```

## 常见问题

**Q: 删除是否可以撤销？**
A: 不可以。删除是永久性的。确认对话框会提醒用户。

**Q: 删除按钮为什么是灰化的？**
A: 当 AI 正在处理请求时（isLoading = true），删除按钮会禁用，防止多次点击。

**Q: 为什么删除后要延迟 500ms 才刷新数据？**
A: 这是为了等待 AI 工具执行完成后再刷新，确保数据准确。

**Q: 可以一次删除多个项目吗？**
A: 目前不支持。需要逐个删除。如需批量删除，可以在 AI 对话中自然表达。

**Q: 删除面板什么时候显示？**
A: 当用户点击 "删除" 按钮时切换显示/隐藏。只有在有可删除项目时才能点击。

## 文件位置

- **删除组件**：`components/delete-actions.tsx`
- **拉齐页面**：`app/align/page.tsx`
- **AI 工具实现**：`app/api/align/route.ts`
- **后端函数**：`lib/user.ts`

## 相关文档

- 删除工具完整指南：`DELETE_TOOLS.md`
- 拉齐功能说明：`QUICK_START.md`
- 用户系统文档：`USER_SYSTEM.md`

